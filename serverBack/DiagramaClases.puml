@startuml

'-----------------------------------------------
'CLASES DENTRO DE ALGORITMOS DE CONSENSO'

Interface AlgoritmoConsenso {
    +ejecutarAlgoritmoConsenso(fuentes: List<Dataset>, coleccion: Coleccion)
}

class AlgoritmoConsensoMayoriaAbsoluta implements AlgoritmoConsenso{
    +ejecutarAlgoritmoConsenso(fuentes: List<Dataset>, coleccion: Coleccion)
    +mapearIdsDatasets(fuentes: List<Dataset>): List<Long>
}

class AlgoritmoConsensoMayoriaSimple implements AlgoritmoConsenso{
    +ejecutarAlgoritmoConsenso(fuentes: List<Dataset>, coleccion: Coleccion)
    +mitadDeFuentesContienenHecho(hecho: Hecho, fuentes: List<Dataset>): List<Long>
}

class AlgoritmoConsensoMultiplesMenciones implements AlgoritmoConsenso{
    +ejecutarAlgoritmoConsenso(fuentes: List<Dataset>, coleccion: Coleccion)
    -dosFuentesContienenHecho(hecho: Hecho): Boolean
    -existeHechoIgualTituloDiferentesAtributos(hecho: Hecho, hechos: List<Hecho>)
    -tienenAtributosDistintos(h1: Hecho, h2: Hecho): Boolean
}



'-----------------------------------------------
'CLASES DENTRO DE FILTROS'

abstract class Filtro {
    -id: Long
}

Interface IFiltro {
    +aprobarHecho(hecho: Hecho): Boolean
    +toSpecification(): Specification(Hecho)
}

class FiltroCategoria implements Filtro {
    -categoria: Categoria
}

class FiltroContenidoMultimedia implements Filtro {
    -tipoContenido: TipoContenido
}

class FiltroDescripcion implements Filtro {
    -descripcion: String
}

class FiltroFechaAcontecimiento implements Filtro {
    -fechaInicial: ZonedDateTime
    -fechaFinal: ZonedDateTime
}

class FiltroFechaCarga implements Filtro {
    -fechaInicial: ZonedDateTime
    -fechaFinal: ZonedDateTime
}

class FiltroOrigen implements Filtro {
    -origenDeseado: Origen
}

class FiltroPais implements Filtro {
    -pais: Pais
}

class FiltroTitulo implements Filtro {
    -titulo: String
}

'-----------------------------------------------
'CLASES DENTRO DE FUENTES'

class FuenteDinamica {
    +crearHecho(data: HechosData): HechoDinamica
}

class FuenteEstatica {
    -dataSet: Dataset
    +leerFuente(usuario: Usuario, buscadorUbicacion: BuscadorUbicacion, buscadorCategoria: BuscadorCategoria): ModificadorHechos
}

' Para próximas entregas
class FuenteProxy {
    -url_base: String
    -access_token: String
    +login(email: String, contraseña: String): Boolean
    +getHechos(hechosTotales: List<Hecho>): List<Hecho>
    +getHechoPorId(id: Integer, hechosTotales: List<Hecho>): Hecho
    +getHechosMetaMapa(url_1: String, filtros: FiltroHechosDTO, hechosTotales: List<Hecho>): List<Hecho>
    +getColeccionesMetaMapa(url_1: String, hechosTotales: List<Hecho>): List<Hecho>
    +getHechosDeColeccionMetaMapa(url_1: String, id: Long, hechosTotales: List<Hecho>): List<Hecho>
    +enviarSolicitudEliminacionMetaMapa(url_1: String, data: SolicitudHechoEliminarInputDTO)
}

'-----------------------------------------------
'CLASES DENTRO DE PERSONAS'

class DatosPersonalesPublicador {
    -nombre: String
    -apellido: String
    -edad: Integer
}

enum Rol {
    VISUALIZADOR
    CONTRIBUYENTE
    ADMINISTRADOR
}

class Usuario {
    -contrasenia: String
    -nombreDeUsuario: String
    -id: Long
    -cantHechosSubidos: Integer
    -rol: Rol
    -datosPersonales: DatosPersonalesPublicador
    +incrementarHechosSubidos()
    +disminuirHechosSubidos()
}

'---------------------------------------------
'CLASES DENTRO DE ENTITIES'

class Categoria{
    -id: Long
    -titulo: String
    -sinonimos: List<Sinonimo>
}

class Sinonimo{
    -id: Long
    -sinonimoStr: String
}

class Coleccion {
    -activo: Boolean
    -id: Long
    -titulo: String
    -descripcion: String
    -hechos: List<Hecho>
    -hechosConsensuados: List<Hecho>
    -algoritmoConsenso: IAlgoritmoConsenso
    -modificado: Boolean
    -criterios: List<Filtro>
    -upsertPorTipo(filtroNuevo : Filtro)
    +setCriterios(filtros: List<Filtro>)
    +addHechos(hechos ... Hecho)
    +addHechos(hechos: List<Hecho>)
}

class FechaParser {
    -FORMATOS_LOCAL: List<DateTimeFormatter>
    -FORMATOS_ZONED: List<DateTimeFormatter>
    +parsearFecha(fechaStr: String): ZonedDateTime
}

class FiltrosColeccion {
    - filtroCategoria : FiltroCategoria
    - filtroPais : FiltroPais
    - filtroProvincia: FiltroProvincia
    - filtroDescripcion : FiltroDescripcion
    - filtroContenidoMultimedia : FiltroContenidoMultimedia
    - filtroFechaAcontecimiento : FiltroFechaAcontecimiento
    - filtroFechaCarga : FiltroFechaCarga
    - filtroOrigen : FiltroOrigen
    - filtroTitulo : FiltroTitulo
}

class Geocodificador {
    +obtenerPais(latitud: Double, longitud: Double)
}

class GestorRoles {
    +VisualizadorAContribuyente(usuario: Usuario): Boolean
    +ContribuyenteAVisualizador(usuario: Usuario): Boolean
}

abstract Hecho {
    -activo: Boolean
    -id: Long
    -usuario: Usuario
    -titulo: String
    -descripcion: String
    -categoria: Categoria
    -contenidoMultimedia: TipoContenido
    -fechaAcontecimiento: ZonedDateTime
    -fechaCarga: ZonedDateTime
    -fechaUltimaActualizacion: ZonedDateTime
    -origen: Origen
    -modificado : Boolean
    -atributosHechoAModificar : List<AtributosHechoModificar>
    -datasets : List<Dataset>
    -ubicacion: Ubicacion
}

class HechoDinamica{
}

class HechoEstatica{
}

class HechoProxy{
}

class Hash{
    +encoder(): BCryptPasswordEncoder
    +generarHash(passwordPlano: String): String
    +verificarPassword(passwordPlano: String, hashGuardado: String): boolean
}

class AtributosHechoModificar{
    -id : Long
    -descripcion : String
    -contenidoMultimedia : TipoContenido
    -fechaAcontecimiento : ZonedDateTime
    -latitud : Double
    -longitud : Double
    -ubicacion : Ubicacion
    -categoria : Categoria
}

class LectorCSV {
    -dataSet: String
    -campos: List<String>
    +leerCSV(hechos: List<Hecho>): ModificadorHechos
    -filtrarColumnas(headers: List<String>): List<Integer>
}

class Mensaje{
    -id: Long
    -solicitud_hecho: SolicitudHecho
    -receptor: Usuario
    -textoMensaje: String
}

class Normalizador{
    +normalizar(texto: String): String
    +normalizarYComparar(s1: String, s2: String): Boolean
    +normalizarSeparado(texto: String)
}

enum Origen {
     FUENTE_DINAMICA
     FUENTE_ESTATICA
     CARGA_MANUAL
     FUENTE_PROXY_METAMAPA
}

class Pais {
    -id: Long
    -pais: String
    -sinonimo: List<Sinonimo>
}

class PaisProvincias {
    -pais: Pais
    -provincias: List<Provincia>
}

class Provincia {
    -id: Long
    -provincia: String
    -pais: Pais
    -sinonimos: List<Sinonimo>
}

'RespuestaHttp

class SolicitudHecho {
    #usuario: Usuario
    #hecho: Hecho
    #id: Long
    #justificacion: String
    #procesada: boolean
    #rechazadaPorSpam: boolean
}

class Ubicacion {
    -id: Long
    -provincia: Provincia
    -pais: Pais
}

enum TipoContenido {
    INVALIDO
    TEXTO
    IMAGEN
    AUDIO
    VIDEO
}

'------------------------------------------------
'CLASES QUE REPRESENTAN TABLAS'

class Estadisticas {
    -id: Long
    -cantidadDeSpam: CantSolicitudesEliminacionSpam
    -categoriaCantidad: CategoriaCantidad
    -categoriaHoras: List<CategoriaHora>
    -categoriaProvincias: List<CategoriaProvincia>
    -coleccionProvincias: List<ColeccionProvincia>
    -timestamp: Instant
}

class CantSolicitudesEliminacionSpam {
    -cantidad: Integer
}

class CategoriaCantidad {
    -id: Long
    -categoria: Categoria
    -cantidad: Integer
}

class CategoriaHora {
    -id: Long
    -categoria: Categoria
    -hora: Integer
    -cantidad: Integer
    -timestamp: Instant
}

class CategoriaProvincia {
    -id: Long
    -categoria: Categoria
    -provincia: Provincia
    -cantidad: Integer
    -timestamp: Instant
}

class ColeccionProvincia {
    -id: Long
    -coleccion: Coleccion
    -provincia: Provincia
    -cantidad: Integer
    -timestamp: Instant
}


'--------------------------------------------
' Relaciones de AlgoritmoConsenso
AlgoritmoConsensoMayoriaAbsoluta ..|> AlgoritmoConsenso
AlgoritmoConsensoMayoriaSimple ..|> AlgoritmoConsenso
AlgoritmoConsensoMultiplesMenciones ..|> AlgoritmoConsenso

Coleccion --> AlgoritmoConsenso
Coleccion *-- Hecho
Coleccion *-- Filtro

AlgoritmoConsenso --> Dataset
AlgoritmoConsenso --> Coleccion
AlgoritmoConsensoMayoriaSimple --> Hecho
AlgoritmoConsensoMayoriaSimple --> Dataset
AlgoritmoConsensoMultiplesMenciones --> Hecho

'--------------------------------------------
' Relaciones de Filtros
Filtro <|-- FiltroCategoria
Filtro <|-- FiltroContenidoMultimedia
Filtro <|-- FiltroDescripcion
Filtro <|-- FiltroFechaAcontecimiento
Filtro <|-- FiltroFechaCarga
Filtro <|-- FiltroOrigen
Filtro <|-- FiltroPais
Filtro <|-- FiltroTitulo

FiltrosColeccion *-- FiltroCategoria
FiltrosColeccion *-- FiltroPais
FiltrosColeccion *-- FiltroDescripcion
FiltrosColeccion *-- FiltroContenidoMultimedia
FiltrosColeccion *-- FiltroFechaAcontecimiento
FiltrosColeccion *-- FiltroFechaCarga
FiltrosColeccion *-- FiltroOrigen
FiltrosColeccion *-- FiltroTitulo

'--------------------------------------------
' Relaciones de Hecho y entidades
Hecho <|-- HechoDinamica
Hecho <|-- HechoEstatica
Hecho <|-- HechoProxy

Hecho --> Usuario
Hecho --> Categoria
Hecho --> TipoContenido
Hecho --> Origen
Hecho --> Ubicacion
Hecho --> Dataset
Hecho *-- AtributosHechoModificar

AtributosHechoModificar --> Ubicacion
AtributosHechoModificar --> TipoContenido
AtributosHechoModificar --> Categoria
AtributosHechoModificar --> Origen

'--------------------------------------------
' Relaciones de Usuario
Usuario --> Rol
Usuario *-- DatosPersonalesPublicador

'--------------------------------------------
' Relaciones de Fuentes
FuenteDinamica --> Hecho
FuenteEstatica --> Hecho
FuenteEstatica --> Dataset
FuenteProxy --> Hecho

'--------------------------------------------
' Relaciones auxiliares
PaisProvincias --> Pais
PaisProvincias --> Provincia
Provincia --> Pais
Ubicacion --> Provincia
Ubicacion --> Pais

HechosData --> Categoria
HechosData --> Ubicacion

SolicitudHecho --* Hecho
Mensaje --> SolicitudHecho
Mensaje --> Usuario

Categoria *-- Sinonimo
Pais *-- Sinonimo
Provincia *-- Sinonimo

CategoriaCantidad --> Categoria
CategoriaHora --> Categoria
CategoriaProvincia --> Categoria
CategoriaProvincia --> Provincia
ColeccionProvincia --> Coleccion
ColeccionProvincia --> Provincia

Estadisticas --> CantSolicitudesEliminacionSpam
Estadisticas --> CategoriaCantidad
Estadisticas --> CategoriaHora
Estadisticas --> CategoriaProvincia
Estadisticas --> ColeccionProvincia

GeneradorEstadisticas --> Hecho
GeneradorEstadisticas --> Coleccion
GeneradorEstadisticas --> SolicitudHecho
GeneradorEstadisticas --> Estadisticas

AnalizadorEstadistico --> Estadisticas

CantSolicitudesEliminacionSpam ..> SolicitudHecho

'--------------------------------------------
' Relación de Formateadores, Buscadores y Parsers
Normalizador --> BuscadorPais
Normalizador --> BuscadorCategoria

BuscadorPais --> FuenteProxy
BuscadorPais --> FuenteEstatica
BuscadorPais --> FuenteDinamica

BuscadorCategoria --> FuenteProxy
BuscadorCategoria --> FuenteEstatica
BuscadorCategoria --> FuenteDinamica

Geocodificador --> FuenteProxy
Geocodificador --> LectorCSV
Geocodificador --> Ubicacion

FechaParser --> LectorCSV
FechaParser --> FuenteProxy

LectorCSV --> Hecho
LectorCSV --> ModificadorHechos
LectorCSV --> FuenteEstatica

@enduml









class Administrador extends Visualizador {
    ' se almacenarán y quedarán a disposición de las personas administradoras.
    -listaContribuyentes: List<Contribuyente>
    'Subida manual del hecho
'    +subirHecho(hecho: Hecho)
'   +crearColeccion(datosColeccion: DatosColeccion, criterios: List<Filtro>, hechosTotales: List<Hecho>)
'   +importarHechos(fuente: Fuente)
'   +evaluarSolicitudEliminacion(solicitud: SolicitudHecho, respuesta: Boolean)
'   +evaluarSolicitudSubirHecho(solicitud: SolicitudHecho, respuesta: Boolean)
}



class aplicarFiltro{
}
' Agregar metodos, APLICAR FILTRO,...


class Contribuyente extends Visualizador {
    -cantHechosSubidos: Integer
    +incrementarHechosSubidos()
    +disminuirHechosSubidos()
    '+solicitarEliminacion(hecho: Hecho)
}



class Visualizador{
    -datosPersonales: DatosPersonalesPublicador
'    +solicitudSubirHecho(hecho: Hecho, GestorPersona: ContextoPersona)
    +navegarPorHechos(filtros: List<Filtro>, coleccion: Coleccion)
    +navegarPorHechos(coleccion: Coleccion)
    ' Llevarlo a clase
    -aplicarFiltros(filtros: List<Filtro>, coleccion: Coleccion): Set<Hecho>
}