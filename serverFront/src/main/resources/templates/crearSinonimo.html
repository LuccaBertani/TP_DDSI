<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/base :: html}">
<main th:fragment="contenido" class="container py-4">

    <section class="text-center py-4"
             style="background: radial-gradient(1200px 600px at 50% -150px, #e8ecf6 0%, #f7f9fb 100%);
                  border-radius:12px;">
        <h2 class="fw-bold mb-1"><i class="bi bi-link-45deg me-2"></i>Crear Sin√≥nimo</h2>
        <p class="text-muted mb-0">Agreg√° un sin√≥nimo para categor√≠as, pa√≠ses o provincias</p>
    </section>

    <div class="row justify-content-center mt-4">
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm" style="border-radius:14px;">
                <div class="card-body p-4">

                    <!-- FORM PRINCIPAL ‚Üí GET para recargar -->
                    <form th:action="@{/gestion/sinonimos/crear}" method="get" th:object="${sinonimoForm}">

                        <!-- üî• Mantener id_entidad en GET y POST -->
                        <input type="hidden" id="hiddenEntidad" name="id_entidad"
                               th:value="${sinonimoForm.id_entidad}"/>

                        <!-- Tipo -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold" for="tipo">Tipo de sin√≥nimo *</label>
                            <select class="form-select" id="tipo" th:field="*{tipo}" required>
                                <option value="">Seleccionar tipo</option>
                                <option value="categoria">Categor√≠a</option>
                                <option value="pais">Pa√≠s</option>
                                <option value="provincia">Provincia</option>
                            </select>
                        </div>

                        <!-- ENTIDAD -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Entidad *</label>

                            <!-- Categor√≠a -->
                            <div id="grupoCategoria" class="mb-2 d-none">
                                <select class="form-select"
                                        onchange="syncEntidad(this.value)">
                                    <option value="">Seleccionar categor√≠a</option>
                                    <option th:each="cat : ${categorias}"
                                            th:value="${cat.id}"
                                            th:text="${cat.categoria}"
                                            th:selected="${sinonimoForm.id_entidad != null and sinonimoForm.id_entidad == cat.id}">
                                    </option>
                                </select>
                            </div>

                            <!-- Pa√≠s -->
                            <div id="grupoPais" class="mb-2 d-none">
                                <select class="form-select"
                                        onchange="syncEntidad(this.value)">
                                    <option value="">Seleccionar pa√≠s</option>
                                    <option th:each="p : ${paises}"
                                            th:value="${p.id}"
                                            th:text="${p.pais}"
                                            th:selected="${sinonimoForm.id_entidad != null and sinonimoForm.id_entidad == p.id}">
                                    </option>
                                </select>
                            </div>

                            <!-- Provincia -->
                            <div id="grupoProvincia" class="mb-2 d-none">

                                <!-- Pa√≠s para cargar provincias -->
                                <select class="form-select mb-2"
                                        id="selectPaisParaProvincia"
                                        name="id_pais"
                                        onchange="this.form.submit()">
                                    <option value="">Seleccionar pa√≠s</option>
                                    <option th:each="p : ${paises}"
                                            th:value="${p.id}"
                                            th:text="${p.pais}"
                                            th:selected="${sinonimoForm.id_pais != null && sinonimoForm.id_pais == p.id}">
                                    </option>
                                </select>

                                <!-- Provincias -->
                                <select class="form-select"
                                        id="selectProvincia"
                                        th:disabled="${provincias == null}"
                                        onchange="syncEntidad(this.value)">
                                    <option value="">Seleccionar provincia</option>
                                    <option th:each="pr : ${provincias}"
                                            th:value="${pr.id}"
                                            th:text="${pr.provincia}"
                                            th:selected="${sinonimoForm.id_entidad != null && sinonimoForm.id_entidad == pr.id}">
                                    </option>
                                </select>

                            </div>
                        </div>

                        <!-- Sin√≥nimo -->
                        <div class="mb-3" style="background:#f8f9fa;border-radius:8px;padding:15px;">
                            <label class="form-label fw-semibold" for="sinonimo">Sin√≥nimo *</label>
                            <input type="text" class="form-control" id="sinonimo"
                                   th:field="*{sinonimo}"
                                   placeholder="Ej: CABA, Incendio, etc." required />
                        </div>

                        <!-- Botones -->
                        <div class="d-flex justify-content-between mt-4">

                            <a class="btn btn-outline-secondary" th:href="@{/usuarios/perfil}">
                                <i class="bi bi-arrow-left me-1"></i> Cancelar
                            </a>

                            <!-- BOT√ìN POST REAL -->
                            <button class="btn btn-dark"
                                    formaction="/gestion/sinonimos/crear"
                                    formmethod="post"
                                    type="submit">
                                <i class="bi bi-check2 me-1"></i> Crear Sin√≥nimo
                            </button>

                            <!-- CSRF SOLO PARA POST -->
                            <input type="hidden" th:if="${_csrf != null}"
                                   th:name="${_csrf.parameterName}"
                                   th:value="${_csrf.token}"/>
                        </div>

                    </form>

                </div>
            </div>

            <style>.btn:hover{transform:translateY(-1px);transition:transform .08s ease}</style>
        </div>
    </div>

    <!-- JS para selects -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tipoSelect = document.getElementById('tipo');
            const grupoCategoria = document.getElementById('grupoCategoria');
            const grupoPais = document.getElementById('grupoPais');
            const grupoProvincia = document.getElementById('grupoProvincia');

            function ocultarTodos() {
                grupoCategoria.classList.add('d-none');
                grupoPais.classList.add('d-none');
                grupoProvincia.classList.add('d-none');
            }

            function actualizarSegunTipo() {
                const tipo = tipoSelect.value;
                ocultarTodos();

                if (tipo === 'categoria') grupoCategoria.classList.remove('d-none');
                if (tipo === 'pais') grupoPais.classList.remove('d-none');
                if (tipo === 'provincia') grupoProvincia.classList.remove('d-none');
            }

            tipoSelect.addEventListener('change', actualizarSegunTipo);
            actualizarSegunTipo(); // Inicializa
        });

        function syncEntidad(value) {
            document.getElementById('hiddenEntidad').value = value;
        }
    </script>

</main>
</html>
