<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/base :: html}"
      xmlns:sec="http://www.w3.org/1999/xhtml">
<main th:fragment="contenido" class="container py-4">

    <section class="hecho-detail-hero">
        <div class="container" style="max-width:1000px;">
            <div th:if="${hecho != null}">

                <div th:if="${AtributosModificarDTO != null}"
                     class="d-flex justify-content-center mb-4">
                    <div class="btn-group detail-tabs" role="group" aria-label="Vista del hecho">
                        <button type="button"
                                id="btn-tab-antes"
                                class="btn btn-sm btn-tab-primary">
                            Versión Original
                        </button>
                        <button type="button"
                                id="btn-tab-propuesta"
                                class="btn btn-sm btn-tab-outline">
                            Propuesta de Modificación
                        </button>
                    </div>
                </div>

                <div class="text-center">
                    <span class="hecho-detail-badge mb-3">
                        <i class="bi bi-tag-fill me-2"></i>
                        <span th:text="${hecho.categoria ?: 'Sin Categoría'}">Categoría</span>
                    </span>
                    <h1 class="display-5 fw-bold mb-2 animated-gradient-text" th:text="${hecho.titulo ?: 'Título del Hecho'}">Título del hecho</h1>
                </div>

                <div th:if="${AtributosModificarDTO != null}" class="mt-4 mb-3">
                    <h2 class="h5 text-center mb-0 text-warning-custom fw-bold">
                        <i class="bi bi-code-square me-2"></i>
                        Revisión de Solicitud de Modificación Pendiente
                    </h2>
                </div>
            </div>
        </div>
    </section>

    <div class="container pb-5" style="max-width:1000px;">

        <div th:if="${AtributosModificarDTO != null}">

            <div id="vista-antes" class="detail-card mb-4">
                <div class="detail-card-header bg-light-custom">
                    <div class="detail-card-icon bg-gradient-gray">
                        <i class="bi bi-file-earmark-check-fill"></i>
                    </div>
                    <h5 class="mb-0 text-dark fw-bold">Datos Originales del Hecho</h5>
                </div>
                <div class="detail-card-body">
                    <div class="row g-4">
                        <div class="col-md-6"><div class="detail-item"><span class="detail-label">Título</span><div class="detail-value" th:text="${hecho.titulo ?: '—'}"></div></div></div>
                        <div class="col-md-6"><div class="detail-item detail-item-multiline"><span class="detail-label">Descripción</span><div class="detail-value" th:text="${hecho.descripcion ?: '—'}"></div></div></div>
                        <div class="col-md-6"><div class="detail-item"><span class="detail-label">Fuente</span><div class="detail-value" th:text="${hecho.fuente ?: '—'}"></div></div></div>
                        <div class="col-md-6"><div class="detail-item"><span class="detail-label">Contribuyente</span><div class="detail-value" th:text="${hecho.username ?: '—'}"></div></div></div>
                        <div class="col-md-6">
                            <div class="detail-item">
                                <span class="detail-label">Fecha de Carga</span>
                                <div class="detail-value"
                                     th:text="${hecho.fechaCarga != null ? #strings.substringBefore(hecho.fechaCarga, 'T') : '—'}">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6"><div class="detail-item"><span class="detail-label">Categoría</span><div class="detail-value" th:text="${hecho.categoria ?: '—'}"></div></div></div>
                        <div class="col-md-6"><div class="detail-item"><span class="detail-label">País</span><div class="detail-value" th:text="${hecho.pais ?: '—'}"></div></div></div>
                        <div class="col-md-6"><div class="detail-item"><span class="detail-label">Provincia</span><div class="detail-value" th:text="${hecho.provincia ?: '—'}"></div></div></div>
                        <div class="col-md-6"><div class="detail-item"><span class="detail-label">Fecha del Acontecimiento</span><div class="detail-value" th:text="${hecho.fechaAcontecimiento != null ? hecho.fechaAcontecimiento : '—'}"></div></div></div>
                        <div class="col-md-6"><div class="detail-item"><span class="detail-label">Latitud</span><div class="detail-value" th:text="${hecho.latitud != null ? hecho.latitud : '—'}"></div></div></div>
                        <div class="col-md-6"><div class="detail-item"><span class="detail-label">Longitud</span><div class="detail-value" th:text="${hecho.longitud != null ? hecho.longitud : '—'}"></div></div></div>
                    </div>
                </div>
            </div>

            <div id="vista-propuesta" class="detail-card mb-4 bg-warning-soft d-none">
                <div class="detail-card-header bg-warning-custom">
                    <div class="detail-card-icon bg-gradient-amber">
                        <i class="bi bi-file-earmark-plus-fill"></i>
                    </div>
                    <h5 class="mb-0 text-dark fw-bold">Atributos Propuestos</h5>
                </div>
                <div class="detail-card-body">
                    <div class="row g-4">
                        <div class="col-md-6"><div class="detail-item bg-light-soft"><span class="detail-label">Título</span><div class="detail-value" th:text="${AtributosModificarDTO.titulo != null ? AtributosModificarDTO.titulo : '—'}"></div></div></div>
                        <div class="col-md-6"><div class="detail-item bg-light-soft"><span class="detail-label">Descripción</span><div class="detail-value" th:text="${AtributosModificarDTO.descripcion != null ? AtributosModificarDTO.descripcion : '—'}"></div></div></div>
                        <div class="col-md-6"><div class="detail-item bg-light-soft"><span class="detail-label">Fuente</span><div class="detail-value" th:text="${hecho.fuente ?: '—'}"></div></div></div>
                        <div class="col-md-6"><div class="detail-item bg-light-soft"><span class="detail-label">Contribuyente</span><div class="detail-value" th:text="${hecho.username ?: '—'}"></div></div></div>
                        <div class="col-md-6">
                            <div class="detail-item">
                                <span class="detail-label">Fecha de Carga</span>
                                <div class="detail-value"
                                     th:text="${hecho.fechaCarga != null ? #strings.substringBefore(hecho.fechaCarga, 'T') : '—'}">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6"><div class="detail-item bg-light-soft"><span class="detail-label">Categoría</span><div class="detail-value" th:text="${AtributosModificarDTO.categoria != null ? AtributosModificarDTO.categoria : '—'}"></div></div></div>
                        <div class="col-md-6"><div class="detail-item bg-light-soft"><span class="detail-label">País</span><div class="detail-value" th:text="${AtributosModificarDTO.pais != null ? AtributosModificarDTO.pais : '—'}"></div></div></div>
                        <div class="col-md-6"><div class="detail-item bg-light-soft"><span class="detail-label">Provincia</span><div class="detail-value" th:text="${AtributosModificarDTO.provincia != null ? AtributosModificarDTO.provincia : '—'}"></div></div></div>
                        <div class="col-md-6"><div class="detail-item bg-light-soft"><span class="detail-label">Fecha del Acontecimiento</span><div class="detail-value"  th:text="${AtributosModificarDTO != null && AtributosModificarDTO.fechaAcontecimiento != null ? AtributosModificarDTO.fechaAcontecimiento : '--'}"> </div></div></div>
                        <div class="col-md-6"><div class="detail-item bg-light-soft"><span class="detail-label">Latitud</span><div class="detail-value" th:text="${AtributosModificarDTO.latitud != null ? AtributosModificarDTO.latitud : '—'}"></div></div></div>
                        <div class="col-md-6"><div class="detail-item bg-light-soft"><span class="detail-label">Longitud</span><div class="detail-value" th:text="${AtributosModificarDTO.longitud != null ? AtributosModificarDTO.longitud : '—'}"></div></div></div>
                        <div class="detail-card mb-4">
                            <div class="detail-card-header">
                                <div class="detail-card-icon bg-gradient-green">
                                    <i class="bi bi-file-earmark-play-fill"></i>
                                </div>
                                <h5 class="mb-0 text-dark fw-bold">Contenido Multimedia</h5>
                            </div>
                            <div class="detail-card-body">
                                <div class="row g-4 justify-content-center">

                                    <div th:if="${AtributosModificarDTO.contenido == null or #lists.isEmpty(AtributosModificarDTO.contenido)}"
                                         class="col-12 text-center text-muted py-3">
                                        No hay contenido multimedia asociado a este hecho.
                                    </div>

                                    <div th:each="media : ${AtributosModificarDTO.contenido}"
                                         class="col-md-6 col-lg-4">

                                        <div class="media-preview-item">

                                            <img th:if="${#strings.endsWith(media.url, '.png') or #strings.endsWith(media.url, '.jpg') or #strings.endsWith(media.url, '.jpeg') or #strings.endsWith(media.url, '.gif')}"
                                                 th:src="${media.url}"
                                                 class="img-fluid rounded media-item-img"
                                                 alt="Contenido multimedia" />

                                            <video th:if="${#strings.endsWith(media.url, '.mp4') or #strings.endsWith(media.url, '.webm') or #strings.endsWith(media.url, '.ogg')}"
                                                   class="img-fluid rounded media-item-img"
                                                   controls>
                                                <source th:src="${media.url}">
                                                Tu navegador no soporta video.
                                            </video>

                                            <div th:if="${#strings.endsWith(media.url, '.txt') or #strings.endsWith(media.url, '.pdf') or #strings.endsWith(media.url, '.docx') or #strings.endsWith(media.url, '.csv') or #strings.endsWith(media.url, '.xlsx')}"
                                                 class="p-4 text-center file-download-box">

                                                <i class="bi bi-file-earmark-text fs-1 text-secondary"></i>
                                                <div class="mt-2">
                                                    <a th:href="${media.url}" target="_blank" class="small fw-bold btn btn-download-link">
                                                        <i class="bi bi-download me-1"></i> Descargar archivo
                                                    </a>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${AtributosModificarDTO == null}" class="detail-card mb-4">
            <div class="detail-card-header">
                <div class="detail-card-icon bg-gradient-violet">
                    <i class="bi bi-info-circle-fill"></i>
                </div>
                <h5 class="mb-0 text-dark fw-bold">Información General del Hecho</h5>
            </div>
            <div class="detail-card-body">
                <div class="row g-4">
                    <div class="col-md-6"><div class="detail-item"><span class="detail-label">Título</span><div class="detail-value" th:text="${hecho.titulo ?: '—'}"></div></div></div>
                    <div class="col-md-6"><div class="detail-item detail-item-multiline"><span class="detail-label">Descripción</span><div class="detail-value" th:text="${hecho.descripcion ?: '—'}"></div></div></div>
                    <div class="col-md-6"><div class="detail-item"><span class="detail-label">Fuente</span><div class="detail-value" th:text="${hecho.fuente ?: '—'}"></div></div></div>
                    <div class="col-md-6"><div class="detail-item"><span class="detail-label">Contribuyente</span><div class="detail-value" th:text="${hecho.username ?: '—'}"></div></div></div>
                    <div class="col-md-6">
                        <div class="detail-item">
                            <span class="detail-label">Fecha de Carga</span>
                            <div class="detail-value"
                                 th:text="${hecho.fechaCarga != null ? #strings.substringBefore(hecho.fechaCarga, 'T') : '—'}">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6"><div class="detail-item"><span class="detail-label">Categoría</span><div class="detail-value" th:text="${hecho.categoria ?: '—'}"></div></div></div>
                    <div class="col-md-6"><div class="detail-item"><span class="detail-label">País</span><div class="detail-value" th:text="${hecho.pais ?: '—'}"></div></div></div>
                    <div class="col-md-6"><div class="detail-item"><span class="detail-label">Provincia</span><div class="detail-value" th:text="${hecho.provincia ?: '—'}"></div></div></div>
                    <div class="col-md-6">
                        <div class="detail-item">
                            <span class="detail-label">Fecha del Acontecimiento</span>
                            <span th:text="${AtributosModificarDTO != null && AtributosModificarDTO.fechaAcontecimiento != null
                        ? AtributosModificarDTO.fechaAcontecimiento
                        : hecho.fechaAcontecimiento}">
        </span>
                        </div>
                    </div>

                    <div class="col-md-6"><div class="detail-item"><span class="detail-label">Latitud</span><div class="detail-value" th:text="${hecho.latitud != null ? hecho.latitud : '—'}"></div></div></div>
                    <div class="col-md-6"><div class="detail-item"><span class="detail-label">Longitud</span><div class="detail-value" th:text="${hecho.longitud != null ? hecho.longitud : '—'}"></div></div></div>
                </div>
            </div>
        </div>

        <div class="detail-card mb-4" id="multimedia-original">
            <div class="detail-card-header">
                <div class="detail-card-icon bg-gradient-green">
                    <i class="bi bi-file-earmark-play-fill"></i>
                </div>
                <h5 class="mb-0 text-dark fw-bold">Contenido Multimedia</h5>
            </div>
            <div class="detail-card-body">
                <div class="row g-4 justify-content-center">

                    <div th:if="${hecho.contenido == null or #lists.isEmpty(hecho.contenido)}"
                         class="col-12 text-center text-muted py-3">
                        No hay contenido multimedia asociado a este hecho.
                    </div>

                    <div th:each="media : ${hecho.contenido}"
                         class="col-md-6 col-lg-4">

                        <div class="media-preview-item">

                            <img th:if="${#strings.endsWith(media.url, '.png') or #strings.endsWith(media.url, '.jpg') or #strings.endsWith(media.url, '.jpeg') or #strings.endsWith(media.url, '.gif')}"
                                 th:src="${media.url}"
                                 class="img-fluid rounded media-item-img"
                                 alt="Contenido multimedia" />

                            <video th:if="${#strings.endsWith(media.url, '.mp4') or #strings.endsWith(media.url, '.webm') or #strings.endsWith(media.url, '.ogg')}"
                                   class="img-fluid rounded media-item-img"
                                   controls>
                                <source th:src="${media.url}">
                                Tu navegador no soporta video.
                            </video>

                            <div th:if="${#strings.endsWith(media.url, '.txt') or #strings.endsWith(media.url, '.pdf') or #strings.endsWith(media.url, '.docx') or #strings.endsWith(media.url, '.csv') or #strings.endsWith(media.url, '.xlsx')}"
                                 class="p-4 text-center file-download-box">

                                <i class="bi bi-file-earmark-text fs-1 text-secondary"></i>
                                <div class="mt-2">
                                    <a th:href="${media.url}" target="_blank" class="small fw-bold btn btn-download-link">
                                        <i class="bi bi-download me-1"></i> Descargar archivo
                                    </a>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex flex-wrap justify-content-center gap-3 mt-4">
            <a class="btn btn-secondary-action" th:href="@{/hechos/public/get-all}">
                <i class="bi bi-list me-1"></i> Volver al listado
            </a>

            <button class="btn btn-danger-action"
                    data-bs-toggle="modal"
                    data-bs-target="#modalReportar"
                    th:if="${puedeReportar}">
                <i class="bi bi-flag me-1"></i> Reportar
            </button>

            <button class="btn btn-danger-action"
                    th:if="${SolicitudHechoEliminarInputDTO != null}"
                    data-bs-toggle="modal"
                    data-bs-target="#modalSolicitarEliminacion">
                <i class="bi bi-trash3 me-1"></i> Solicitar eliminación
            </button>

            <form th:if="${!esSolicitud}"
                  sec:authorize="hasRole('ADMINISTRADOR')"
                  th:action="@{/hechos/eliminar-hecho(id=${hecho.id}, fuente=${hecho.fuente})}"
                  method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button class="btn btn-danger-action">
                    <i class="bi bi-trash3 me-1"></i> Eliminar
                </button>
            </form>

            <form th:if="${SolicitudHechoModificarInputDTO != null}"
                  th:object="${SolicitudHechoModificarInputDTO}"
                  th:action="@{/solicitud-modificacion}"
                  method="post"
                  class="d-inline">
                <input type="hidden" th:field="*{id_hecho}" />
                <input type="hidden" th:field="*{titulo}" />
                <input type="hidden" th:field="*{descripcion}" />
                <input type="hidden" th:field="*{latitud}" />
                <input type="hidden" th:field="*{longitud}" />
                <input type="hidden" th:field="*{fechaAcontecimiento}" />
                <input type="hidden" th:field="*{id_pais}" />
                <input type="hidden" th:field="*{id_provincia}" />
                <input type="hidden" th:field="*{id_categoria}" />
                <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                <button type="submit" class="btn btn-warning-action">
                    <i class="bi bi-pencil-square me-1"></i> Solicitar modificación
                </button>
            </form>

            <form th:if="${!esSolicitud && HechoModificarInputDTO != null and #authorization.expression('hasRole(''ADMINISTRADOR'')')}"
                  th:object="${HechoModificarInputDTO}"
                  th:action="@{/modificacion-hecho}"
                  method="post"
                  class="d-inline">
                <input type="hidden" th:field="*{id_hecho}" />
                <input type="hidden" th:field="*{titulo}" />
                <input type="hidden" th:field="*{descripcion}" />
                <input type="hidden" th:field="*{latitud}" />
                <input type="hidden" th:field="*{longitud}" />
                <input type="hidden" th:field="*{fechaAcontecimiento}" />
                <input type="hidden" th:field="*{id_pais}" />
                <input type="hidden" th:field="*{id_provincia}" />
                <input type="hidden" th:field="*{id_categoria}" />
                <input type="hidden" th:field="*{fuente}" />
                <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                <button type="submit" class="btn btn-warning-action">
                    <i class="bi bi-pencil-square me-1"></i> Modificar
                </button>
            </form>
        </div>

    </div>

    <div class="modal fade" id="modalReportar" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-lg" style="max-width:600px">
            <form class="modal-content modal-content-custom" th:action="@{/solicitudes-hecho/reportes/reportar}" method="post">
                <div class="modal-header modal-header-violet">
                    <h5 class="modal-title fw-bold text-white"><i class="bi bi-flag-fill me-2"></i>Reportar hecho</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="small text-muted mb-3">Contanos por qué este hecho debería ser revisado.</p>
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Motivo</label>
                        <textarea class="form-control form-control-custom" name="motivo" rows="4" maxlength="300" required></textarea>
                        <div class="form-text text-end">máx. 300 caracteres</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary-action" type="button" data-bs-dismiss="modal">Cancelar</button>
                    <button class="btn btn-danger-action" type="submit"><i class="bi bi-flag me-1"></i>Enviar reporte</button>
                </div>
                <input type="hidden" name="id_hecho" th:value="${hecho.id}"/>
                <input type="hidden" name="fuente" th:if="${hecho.fuente != null}" th:value="${hecho.fuente}"/>
                <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            </form>
        </div>
    </div>

    <div class="modal fade" id="modalSolicitarEliminacion" tabindex="-1" aria-hidden="true"
         th:if="${SolicitudHechoEliminarInputDTO != null}">
        <div class="modal-dialog modal-dialog-centered modal-dialog-lg" style="max-width:600px">
            <form class="modal-content modal-content-custom"
                  th:action="@{/solicitudes-hecho/eliminar-hecho}"
                  method="post"
                  th:object="${SolicitudHechoEliminarInputDTO}">

                <div class="modal-header modal-header-violet">
                    <h5 class="modal-title fw-bold text-white">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        Solicitar eliminación del hecho
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <p class="small text-muted mb-3">
                        Esta solicitud será revisada por el equipo de MetaMapa. Explicá con detalle por qué
                        considerás que este hecho debería ser eliminado.
                    </p>

                    <label class="form-label fw-semibold mb-2" for="justificacionEliminar">
                        Justificación de la eliminación
                    </label>
                    <textarea class="form-control form-control-custom"
                              id="justificacionEliminar"
                              th:field="*{justificacion}"
                              rows="5"
                              minlength="500"
                              maxlength="999"
                              placeholder="Explicá con el mayor detalle posible por qué querés que se elimine este hecho..."
                              required></textarea>

                    <div class="form-text text-end mt-2">
                        <i class="bi bi-info-circle me-1"></i>
                        Mínimo 500 caracteres y máximo 1000 caracteres (describí bien el motivo).
                    </div>
                </div>

                <input type="hidden" th:field="*{id_hecho}" />

                <input type="hidden" th:if="${_csrf != null}"
                       th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                <div class="modal-footer">
                    <button class="btn btn-secondary-action" type="button" data-bs-dismiss="modal">
                        Cancelar
                    </button>
                    <button class="btn btn-danger-action" type="submit">
                        <i class="bi bi-trash3 me-1"></i> Enviar solicitud de eliminación
                    </button>
                </div>
            </form>
        </div>
    </div>


    <style>
        :root{--color-primary:#667eea;--color-primary-dark:#5568d3;--color-secondary:#475569;--color-success:#10b981;--color-warning:#f59e0b;--color-danger:#b91c1c;--color-info:#8b5cf6;--color-light:#f8f9ff;--color-border:#e9ecef;--color-primary-violet:#4f46e5;--color-primary-violet-focus:rgba(79,70,229,.12);--color-yellow-soft:#fff3cd;--color-red-soft:#fee2e2;--color-gray-dark:#343a40;--color-violet-light:#e0e7ff;--color-violet-header:#6d28d9}
        .hecho-detail-hero{padding:60px 0 40px;background:radial-gradient(ellipse 1400px 800px at 50% -100px,rgba(79,70,229,.15) 0%,transparent 50%);position:relative;overflow:hidden}
        .hecho-detail-hero::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%234f46e5' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");pointer-events:none}
        .hecho-detail-badge{background:linear-gradient(135deg, rgba(79, 70, 229, .15), rgba(129, 140, 248, .15));color:var(--color-primary-violet);padding:.65rem 1.5rem;border-radius:50px;font-size:.875rem;font-weight:600;display:inline-flex;align-items:center;border:1px solid rgba(79, 70, 229, .2)}
        .animated-gradient-text{background:linear-gradient(120deg, var(--color-primary-violet), var(--color-info), #ec4899);background-size:200% auto;-webkit-background-clip:text;background-clip:text;color:transparent;animation:mm-gradient-move 6s ease infinite}
        @keyframes mm-gradient-move{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
        .text-warning-custom{color:var(--color-warning) !important}
        .detail-tabs .btn{padding:.75rem 1.5rem;border-radius:12px;font-weight:600;font-size:.9rem;transition:all .2s ease}
        .detail-tabs .btn-tab-primary{background-color:var(--color-primary-violet);color:#fff;border-color:var(--color-primary-violet)}
        .detail-tabs .btn-tab-primary:hover{background-color:#4338ca;border-color:#4338ca;transform:translateY(-1px)}
        .detail-tabs .btn-tab-outline{background-color:transparent;color:var(--color-primary-violet);border-color:var(--color-primary-violet)}
        .detail-tabs .btn-tab-outline:hover{background-color:var(--color-primary-violet-focus);color:var(--color-primary-violet);transform:translateY(-1px)}
        .detail-card{background:#fff;border-radius:20px;border:1px solid var(--color-border);box-shadow:0 4px 12px rgba(0, 0, 0, .05);overflow:hidden}
        .detail-card-header{padding:1.5rem;background:var(--color-light);border-bottom:1px solid var(--color-border);display:flex;align-items:center;gap:1rem}
        .detail-card-header.bg-light-custom{background-color:var(--color-violet-light)}
        .detail-card-header.bg-warning-custom{background-color:#fefce8}
        .detail-card-icon{width:48px;height:48px;background:linear-gradient(135deg, var(--color-primary-violet), #8b5cf6);border-radius:14px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.5rem;box-shadow:0 4px 12px rgba(79, 70, 229, .3)}
        .detail-card-icon.bg-gradient-gray{background:linear-gradient(135deg,var(--color-secondary),#6c757d)}
        .detail-card-icon.bg-gradient-amber{background:linear-gradient(135deg, var(--color-warning), #fbbf24)}
        .detail-card-icon.bg-gradient-green{background:linear-gradient(135deg, var(--color-success), #059669)}
        .detail-card-icon.bg-gradient-violet{background:linear-gradient(135deg, var(--color-primary-violet), #8b5cf6)}
        .detail-card-body{padding:2rem}
        .bg-warning-soft{background-color:var(--color-yellow-soft) !important}
        .bg-light-soft{background-color:var(--color-light) !important}
        .detail-item{display:flex;flex-direction:column;gap:.5rem;padding:1rem;background:#fff;border-radius:12px;border:1px solid var(--color-border);box-shadow:0 1px 3px rgba(0,0,0,0.03);height:100%}
        .detail-item-multiline{max-height:150px;overflow-y:auto}
        .detail-label{font-size:.85rem;font-weight:600;color:var(--color-secondary);display:flex;align-items:center;padding-bottom:.25rem;border-bottom:1px dashed var(--color-border)}
        .detail-value{font-size:.95rem;color:#1a202c;font-weight:500;padding-top:.5rem}
        .media-preview-item{background:#fff;border-radius:16px;border:1px solid var(--color-border);box-shadow:0 2px 8px rgba(0,0,0,.05);overflow:hidden;height:100%;display:flex;flex-direction:column;justify-content:space-between;align-items:stretch}
        .media-item-img{width:100%;height:220px;object-fit:cover;border-radius:16px 16px 0 0}
        .file-download-box{background:#f8f9ff;padding:2rem !important}
        .btn-download-link{color:var(--color-secondary);text-decoration:none;border:1px solid var(--color-border);padding:.5rem 1rem;border-radius:8px;font-weight:500;background:#fff}
        .btn-download-link:hover{background:#f1f3f5;transform:translateY(-1px)}
        .btn{border-radius:12px;padding:.75rem 1.5rem;font-weight:600;transition:all .08s ease}
        .btn:hover{transform:translateY(-1px)}
        .btn-secondary-action{background:#fff;border:2px solid var(--color-border);color:var(--color-secondary)}
        .btn-secondary-action:hover{border-color:var(--color-primary-violet);color:var(--color-primary-violet)}
        .btn-danger-action{background-color:var(--color-danger);color:#fff;border:none}
        .btn-danger-action:hover{background-color:#9f1212}
        .btn-warning-action{background-color:var(--color-warning);color:var(--color-gray-dark);border:none}
        .btn-warning-action:hover{background-color:#d97706;color:#fff}
        .modal-content-custom{border-radius:20px;overflow:hidden;border:none}
        .modal-header-violet{background:linear-gradient(135deg,var(--color-primary-violet),var(--color-violet-header));color:#fff;border:none;padding:2rem}
        .btn-close-white{filter:invert(1) grayscale(100%) brightness(200%)}
        .form-control-custom{border-radius:12px;border:1px solid var(--color-border);background:var(--color-light)}
        .form-control-custom:focus{border-color:var(--color-primary-violet);box-shadow:0 0 0 .18rem var(--color-primary-violet-focus)}
        @media (max-width:768px){.hecho-detail-hero{padding:30px 0 10px}.display-5{font-size:2rem}.detail-card-body{padding:1.5rem}.detail-tabs .btn{padding:.6rem 1rem;font-size:.8rem}.file-download-box{padding:1.5rem !important}.media-item-img{height:180px}.d-flex.flex-wrap.justify-content-center.gap-3{gap:.5rem !important}}
    </style>

    <script>
        (function () {
            const btnAntes = document.getElementById('btn-tab-antes');
            const btnPropuesta = document.getElementById('btn-tab-propuesta');
            const vistaAntes = document.getElementById('vista-antes');
            const vistaPropuesta = document.getElementById('vista-propuesta');
            const multimediaOriginal = document.getElementById('multimedia-original');

            if (!btnAntes || !btnPropuesta || !vistaAntes || !vistaPropuesta) {
                return;
            }

            function activar(tab) {
                const esAntes = (tab === 'antes');

                // tarjetas de datos
                vistaAntes.classList.toggle('d-none', !esAntes);
                vistaPropuesta.classList.toggle('d-none', esAntes);

                // multimedia original SOLO en la vista "antes"
                if (multimediaOriginal) {
                    multimediaOriginal.classList.toggle('d-none', !esAntes);
                }

                // estilos de botones
                btnAntes.classList.toggle('btn-tab-primary', esAntes);
                btnAntes.classList.toggle('btn-tab-outline', !esAntes);

                btnPropuesta.classList.toggle('btn-tab-primary', !esAntes);
                btnPropuesta.classList.toggle('btn-tab-outline', esAntes);
            }

            // estado inicial: versión original
            activar('antes');

            btnAntes.addEventListener('click', function () {
                activar('antes');
            });

            btnPropuesta.addEventListener('click', function () {
                activar('propuesta');
            });
        })();
    </script>

</main>
</html>