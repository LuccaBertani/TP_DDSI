<!-- templates/hecho.html -->
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/base :: html}">

<main th:fragment="contenido">

    <!-- Hero Header -->
    <section class="hero-header py-5 mb-4">
        <div class="container">
            <div class="row align-items-end justify-content-between g-4">
                <div class="col-lg-7">
                    <div class="d-inline-flex align-items-center gap-2 mb-3 feature-badge">
                        <i class="bi bi-clock-history"></i>
                        <span>Explora la historia</span>
                    </div>
                    <h1 class="display-5 fw-bold mb-3">Hechos Históricos</h1>
                    <p class="lead text-muted mb-0">
                        Descubrí y explorá acontecimientos históricos públicos de todo el mundo
                    </p>
                </div>
                <div class="col-lg-5">
                    <div class="d-flex flex-wrap align-items-center justify-content-lg-end gap-3"
                         th:if="${listaHechos != null and !#lists.isEmpty(listaHechos)}">
                        <!-- Badge con total de resultados -->
                        <span class="results-badge">
                            <i class="bi bi-check-circle-fill"></i>
                            <span th:text="${#lists.size(listaHechos)} + ' resultados'">0 resultados</span>
                        </span>

                        <!-- Contador dinámico -->
                        <span id="rangeInfo" class="text-muted small">Viendo 1–0 de 0 resultados</span>

                        <!-- Selector de paginación -->
                        <div class="d-flex align-items-center gap-2">
                            <label for="pageSize" class="text-muted small mb-0">Mostrar:</label>
                            <select id="pageSize" class="form-select form-select-sm" style="width:auto;border-radius:10px">
                                <option value="10">10</option>
                                <option value="20" selected>20</option>
                                <option value="30">30</option>
                                <option value="40">40</option>
                                <option value="50">50</option>
                                <option value="0">Todos</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="container pb-5">
        <!-- Estado vacío -->
        <div th:if="${listaHechos == null or #lists.isEmpty(listaHechos)}" class="empty-state-box">
            <div class="empty-illustration">
                <i class="bi bi-file-earmark-text"></i>
            </div>
            <h3 class="mb-2">No se encontraron hechos</h3>
            <p class="text-muted mb-4">
                Intentá ajustar los filtros de búsqueda o explorá el listado completo de hechos históricos
            </p>
            <a th:href="@{/hechos/public/get-all}" class="btn btn-primary btn-lg">
                <i class="bi bi-list-ul me-2"></i>Ver todos los hechos
            </a>
        </div>

        <!-- Grid de tarjetas -->
        <div id="hechosGrid" class="row g-4" th:if="${listaHechos != null and !#lists.isEmpty(listaHechos)}">
            <div class="col-12 col-md-6 col-lg-4 hecho-card" th:each="h : ${listaHechos}">
                <article class="fact-card">
                    <div class="fact-header">
                        <div class="d-flex justify-content-between align-items-start gap-2">
                            <h5 class="fact-title" th:text="${h.titulo}">Título del hecho</h5>
                            <span class="category-badge" th:if="${h.categoria != null}" th:text="${h.categoria}">Categoría</span>
                        </div>
                    </div>

                    <div class="fact-body">
                        <p class="fact-description" th:text="${h.descripcion}">Descripción del hecho histórico con detalles relevantes...</p>

                        <div class="fact-metadata">
                            <div class="metadata-item" th:if="${h.fechaAcontecimiento != null}">
                                <div class="metadata-icon"><i class="bi bi-calendar-event"></i></div>
                                <span th:text="${h.fechaAcontecimiento}">01/01/2000</span>
                            </div>

                            <div class="metadata-item" th:if="${h.getPais() != null}" th:attr="data-pais-id=${h.getId_pais()}">
                                <div class="metadata-icon"><i class="bi bi-globe-americas"></i></div>
                                <span th:text="${h.getPais()}">País</span>
                            </div>

                            <div class="metadata-item" th:if="${h.getProvincia() != null}" th:attr="data-provincia-id=${h.getId_provincia()}">
                                <div class="metadata-icon"><i class="bi bi-geo-alt-fill"></i></div>
                                <span th:text="${h.getProvincia()}">Provincia</span>
                            </div>

                            <div class="metadata-item" th:if="${h.latitud != null and h.longitud != null}">
                                <div class="metadata-icon"><i class="bi bi-pin-map-fill"></i></div>
                                <span><span th:text="${h.latitud}">lat</span>, <span th:text="${h.longitud}">lng</span></span>
                            </div>
                        </div>
                    </div>

                    <div class="fact-footer">
                        <a class="btn btn-primary w-100" th:unless="${h.fuente == null}" th:href="@{/hechos/public/get(id_hecho=${h.id}, fuente=${h.fuente})}">
                            <i class="bi bi-eye me-2"></i>Ver detalles completos
                        </a>
                    </div>
                </article>
            </div>
        </div>
    </div>

    <style>
        .hero-header{padding:3rem 0 2rem;background:radial-gradient(1200px 500px at 50% -220px,rgba(124,58,237,.03)0,#fff 55%);position:relative;overflow:hidden;border-bottom:1px solid #f3f4ff}
        .hero-header::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%237c3aed' fill-opacity='0.02'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");opacity:.4;pointer-events:none}
        .feature-badge{background:rgba(124,58,237,.04);color:#7c3aed;padding:.45rem 1.1rem;border-radius:999px;font-size:.82rem;font-weight:600;border:1px solid rgba(124,58,237,.16)}
        .results-badge{background:#fff;padding:.7rem 1.3rem;border-radius:999px;border:1px solid #e5e7eb;display:inline-flex;align-items:center;gap:.45rem;font-weight:600;color:#111827;box-shadow:0 4px 14px rgba(15,23,42,.04);font-size:.82rem}
        .results-badge i{color:#22c55e;font-size:.95rem}
        .empty-state-box{background:#fff;border-radius:22px;padding:3.5rem 2rem;text-align:center;border:1px solid #e5e7eb;box-shadow:0 10px 26px rgba(15,23,42,.04)}
        .empty-illustration{width:100px;height:100px;margin:0 auto 1.7rem;background:linear-gradient(135deg,#ede9fe,#f9fafb);border-radius:50%;display:flex;align-items:center;justify-content:center}
        .empty-illustration i{font-size:2.4rem;color:#7c3aed}
        .fact-card{background:#fff;border-radius:22px;border:1px solid rgba(124,58,237,.14);box-shadow:0 8px 22px rgba(15,23,42,.03);transition:all .24s cubic-bezier(.33,.02,.11,.99);height:100%;display:flex;flex-direction:column;position:relative}
        .fact-card::before{content:'';position:absolute;left:18px;right:18px;top:0;height:3px;border-radius:999px;background:linear-gradient(90deg,#7c3aed,#a855f7);opacity:0;transform:scaleX(.4);transform-origin:center;transition:all .24s}
        .fact-card:hover{transform:translateY(-4px);box-shadow:0 14px 32px rgba(15,23,42,.08);border-color:rgba(124,58,237,.28)}
        .fact-card:hover::before{opacity:1;transform:scaleX(1)}
        .fact-header{padding:1.3rem 1.4rem 1rem;background:transparent}
        .fact-title{font-size:1.03rem;font-weight:700;color:#111827;margin:0;line-height:1.4}
        .category-badge{background:#fff;color:#7c3aed;padding:.28rem .7rem;border-radius:999px;font-size:.7rem;font-weight:600;border:1px solid rgba(124,58,237,.35);box-shadow:0 2px 6px rgba(124,58,237,.12)}
        .fact-body{padding:0 1.4rem 1rem;flex-grow:1}
        .fact-description{color:#4b5563;font-size:.88rem;line-height:1.6;margin-bottom:1.1rem;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
        .fact-metadata{display:flex;flex-direction:column;gap:.6rem}
        .metadata-item{display:flex;align-items:center;gap:.65rem;font-size:.82rem;color:#6b7280}
        .metadata-icon{width:28px;height:28px;background:#faf5ff;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0;border:1px solid rgba(124,58,237,.12)}
        .metadata-icon i{font-size:.8rem;color:#7c3aed}
        .fact-footer{padding:.85rem 1.4rem 1.3rem;border-top:1px solid #eef2ff}
        .btn{border-radius:14px;font-weight:600;transition:all .18s ease;padding:.6rem 1.2rem}
        .btn:hover{transform:translateY(-2px)}
        .fact-card .btn-primary{background:#fff;color:#7c3aed;border:1.5px solid #7c3aed;box-shadow:none}
        .fact-card .btn-primary:hover{background:linear-gradient(135deg,#7c3aed,#a855f7);color:#fff;border-color:transparent;box-shadow:0 8px 18px rgba(124,58,237,.35)}
        @media(max-width:768px){.hero-header{padding:2.3rem 0 1.4rem!important}.display-5{font-size:2rem}.results-badge{padding:.5rem 1rem;font-size:.78rem}.empty-state-box{padding:3rem 1.5rem}.empty-illustration{width:80px;height:80px}.empty-illustration i{font-size:2rem}}
    </style>

    <!-- Script: muestra N tarjetas o todas, actualiza contador y recuerda preferencia -->
    <script>
        (function () {
            const grid = document.getElementById('hechosGrid');
            if (!grid) return;

            const cards = Array.from(grid.querySelectorAll('.hecho-card'));
            const total = cards.length;

            const select = document.getElementById('pageSize');
            const info   = document.getElementById('rangeInfo');

            // Preferencia previa (opcional)
            const saved = localStorage.getItem('hechosPageSize');
            if (saved !== null && select.querySelector(`option[value="${saved}"]`)) {
                select.value = saved;
            }

            function render() {
                const n = parseInt(select.value, 10);
                const showAll = (n === 0) || (n >= total);

                cards.forEach((card, idx) => {
                    card.style.display = (showAll || idx < n) ? '' : 'none';
                });

                const shown = showAll ? total : Math.min(n, total);
                if (info) info.textContent = `Viendo 1–${shown} de ${total} resultados`;
            }

            select.addEventListener('change', () => {
                localStorage.setItem('hechosPageSize', select.value);
                render();
            });

            render();
        })();
    </script>

</main>
</html>