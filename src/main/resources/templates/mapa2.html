<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa - MetaMapa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <link href="../static/css/styles.css" rel="stylesheet">

    <style>
        :root {
            --primary-color: #4f46e5;
        }


        .map-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        #map {
            height: 600px;
            width: 100%;
        }

        .fact-list-item {
            padding: 12px;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .fact-list-item:hover {
            background-color: #f8f9fa;
        }

        .fact-list-item:last-child {
            border-bottom: none;
        }

        .fact-list-item.selected {
            background-color: #e7f3ff;
            border-left: 3px solid var(--primary-color);
        }

        .custom-marker {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            cursor: pointer;
        }

        .marker-politica { background: #4f46e5; }
        .marker-exploracion { background: #059669; }
        .marker-guerra { background: #dc2626; }
        .marker-independencia { background: #f59e0b; }
        .marker-cientifica { background: #7c3aed; }

        .leaflet-popup-content-wrapper {
            border-radius: 8px;
        }

        .popup-content h6 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .popup-content .badge {
            font-size: 0.75rem;
        }

        @media (max-width: 768px) {
            #map {
                height: 400px;
            }

            .map-sidebar {
                margin-top: 20px;
            }
        }

    </style>
</head>

<body>

<!-- Header del Dashboard -->
<header class="dashboard-header py-3">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col-md-6">
                <a href="index.html" class="text-decoration-none text-dark d-flex align-items-center">
                    <div class="logo-icon me-2">M</div>
                    <span class="fs-4 fw-bold">MetaMapa</span>
                    <span class="text-muted ms-2 d-none d-md-inline">Panel de Control</span>
                </a>
            </div>
            <div class="col-md-6 text-end">
                <span class="me-2">Bienvenido, <strong>Usuario</strong></span>
                <a href="index.html" class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-box-arrow-right me-1"></i>Cerrar Sesión
                </a>
            </div>
        </div>
    </div>
</header>

<!-- Navegación Principal -->
<nav class="bg-white border-bottom">
    <div class="container-fluid py-3">
        <ul class="nav nav-pills nav-pills-custom justify-content-center">
            <li class="nav-item">
                <a class="nav-link" href="dashboard.html">
                    <i class="bi bi-file-text me-1"></i> Hechos
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" href="mapa.html">
                    <i class="bi bi-map me-1"></i> Mapa
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="colecciones.html">
                    <i class="bi bi-collection me-1"></i> Colecciones
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="contribuir.html">
                    <i class="bi bi-plus me-1"></i> Contribuir
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="solicitudes.html">
                    <i class="bi bi-clipboard-check me-1"></i> Solicitudes
                    <span class="badge bg-danger ms-1">11</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="gestion.html">
                    <i class="bi bi-gear me-1"></i> Gestión
                </a>
            </li>
        </ul>
    </div>
</nav>

<!-- Contenido Principal - Mapa -->
<main class="container-fluid py-4 fade-in">

    <!-- Controles de búsqueda y filtrado -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="input-group">
                <span class="input-group-text bg-white">
                    <i class="bi bi-search text-muted"></i>
                </span>
                <input type="text" id="searchInput" class="form-control" placeholder="Buscar ubicaciones en el mapa..." style="border-left: none;">
            </div>
        </div>
        <div class="col-md-4">
            <select class="form-select" id="categoryFilter">
                <option value="">Todas las categorías</option>
                <option value="politica">Política</option>
                <option value="exploracion">Exploración</option>
                <option value="guerra">Guerra</option>
                <option value="independencia">Independencia</option>
                <option value="cientifica">Científica</option>
            </select>
        </div>
    </div>

    <!-- Container principal del mapa -->
    <div class="map-container">
        <!-- Header del mapa -->
        <div class="bg-light border-bottom p-4">
            <div class="d-flex align-items-center">
                <i class="bi bi-globe text-primary fs-2 me-3"></i>
                <div>
                    <h3 class="mb-1">Mapa Mundial de Hechos Históricos</h3>
                    <p class="text-muted mb-0">Haz clic en los marcadores para ver detalles de cada evento histórico</p>
                </div>
            </div>
        </div>

        <!-- Contenido principal del mapa -->
        <div class="row g-0">
            <!-- Área del mapa -->
            <div class="col-lg-8">
                <div id="map"></div>
            </div>

            <!-- Sidebar con información -->
            <div class="col-lg-4 border-start bg-white">
                <div class="p-4">
                    <!-- Estado inicial -->
                    <div id="defaultView" class="text-center py-4 mb-4 bg-light rounded">
                        <i class="bi bi-bullseye text-muted" style="font-size: 3rem;"></i>
                        <h5 class="mt-3 mb-2">Selecciona un evento</h5>
                        <p class="text-muted small mb-0">Haz clic en cualquier marcador del mapa para ver información detallada</p>
                    </div>

                    <!-- Vista de detalle del hecho seleccionado -->
                    <div id="factDetail" class="d-none">
                        <div class="mb-3">
                            <button class="btn btn-sm btn-outline-secondary mb-3" onclick="clearSelection()">
                                <i class="bi bi-arrow-left me-1"></i>Volver
                            </button>
                            <h5 id="factTitle" class="fw-bold"></h5>
                            <span id="factCategory" class="badge mb-3"></span>
                        </div>
                        <p id="factDescription" class="text-muted mb-3"></p>
                        <div class="mb-3">
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-geo-alt text-muted me-2"></i>
                                <span id="factLocation" class="small"></span>
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-calendar text-muted me-2"></i>
                                <span id="factDate" class="small"></span>
                            </div>
                            <div class="d-flex align-items-center">
                                <i class="bi bi-folder2 text-muted me-2"></i>
                                <span id="factMedia" class="small text-warning"></span>
                            </div>
                        </div>
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary btn-sm">
                                <i class="bi bi-eye me-1"></i>Ver Detalles Completos
                            </button>
                            <button class="btn btn-outline-danger btn-sm">
                                <i class="bi bi-exclamation-triangle me-1"></i>Reportar
                            </button>
                        </div>
                    </div>

                    <!-- Lista de hechos disponibles -->
                    <div>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="fw-bold mb-0">Eventos en el Mapa</h6>
                            <span class="badge bg-primary" id="eventCount">6 eventos</span>
                        </div>

                        <!-- Lista de eventos -->
                        <div class="border rounded" id="factsList">
                            <!-- Los elementos se generarán dinámicamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Estadísticas del mapa -->
    <div class="row mt-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-pin-map text-primary fs-1"></i>
                    <h5 class="mt-2" id="statsEvents">6</h5>
                    <p class="text-muted mb-0 small">Eventos Mostrados</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-globe text-success fs-1"></i>
                    <h5 class="mt-2" id="statsCountries">5</h5>
                    <p class="text-muted mb-0 small">Países Representados</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-calendar-range text-warning fs-1"></i>
                    <h5 class="mt-2">500+</h5>
                    <p class="text-muted mb-0 small">Años de Historia</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-eye text-info fs-1"></i>
                    <h5 class="mt-2">1,247</h5>
                    <p class="text-muted mb-0 small">Visualizaciones Hoy</p>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Importo una libreria js de Mapa -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
<script>
    // Datos de hechos históricos con coordenadas reales
    const historicalFacts = [
        {
            id: 1,
            title: "Revolución de Mayo",
            category: "politica",
            description: "Inicio del proceso independentista argentino que marcó el comienzo de la lucha por la independencia.",
            location: "Buenos Aires, Argentina",
            date: "24 de Mayo de 1810",
            multimedia: "3 archivos multimedia",
            lat: -34.6118,
            lng: -58.3960
        },
        {
            id: 2,
            title: "Descubrimiento de América",
            category: "exploracion",
            description: "Llegada de Cristóbal Colón al continente americano, evento que cambió la historia mundial.",
            location: "San Salvador, Bahamas",
            date: "12 de Octubre de 1492",
            multimedia: "5 archivos multimedia",
            lat: 24.0625,
            lng: -74.5350
        },
        {
            id: 3,
            title: "Caída del Muro de Berlín",
            category: "politica",
            description: "Fin simbólico de la Guerra Fría y reunificación alemana después de décadas de división.",
            location: "Berlín, Alemania",
            date: "9 de Noviembre de 1989",
            multimedia: "8 archivos multimedia",
            lat: 52.5200,
            lng: 13.4050
        },
        {
            id: 4,
            title: "Independencia de México",
            category: "independencia",
            description: "Grito de Dolores que inició la independencia mexicana con Miguel Hidalgo.",
            location: "Dolores Hidalgo, México",
            date: "16 de Septiembre de 1810",
            multimedia: "4 archivos multimedia",
            lat: 21.1619,
            lng: -100.9317
        },
        {
            id: 5,
            title: "Primera Guerra Mundial",
            category: "guerra",
            description: "Conflicto global que involucró a las principales potencias mundiales entre 1914 y 1918.",
            location: "Europa, África, Asia",
            date: "28 de Julio de 1914",
            multimedia: "15 archivos multimedia",
            lat: 49.2827,
            lng: -123.1207
        },
        {
            id: 6,
            title: "Revolución Industrial",
            category: "cientifica",
            description: "Período de transformación económica, social y tecnológica iniciado en Gran Bretaña.",
            location: "Manchester, Reino Unido",
            date: "1760 - 1840",
            multimedia: "12 archivos multimedia",
            lat: 53.4808,
            lng: -2.2426
        },
        {
            id: 7,
            title: "Fundación de Córdoba",
            category: "politica",
            description: "Fundación de la ciudad de Córdoba por Jerónimo Luis de Cabrera.",
            location: "Córdoba, Argentina",
            date: "6 de Julio de 1573",
            multimedia: "2 archivos multimedia",
            lat: -31.4201,
            lng: -64.1888
        }
    ];

    // Variables globales
    let map; // Lo uso para referenciar el objeto de la libreria de js del mapa
    let markers = [];
    let selectedFactId = null;

    // Inicializar el mapa
    function initMap() {
        map = L.map('map').setView([-20, -60], 3);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        addMarkersToMap();
        generateFactsList();
        updateStats();
    }

    // Agregar marcadores al mapa, Los dibuja
    function addMarkersToMap(factsToShow = historicalFacts) {
        // Limpiar marcadores existentes
        markers.forEach(marker => map.removeLayer(marker));
        markers = [];

        factsToShow.forEach(fact => {
            const markerIcon = L.divIcon({
                className: 'custom-marker',
                html: `<div class="custom-marker marker-${fact.category}">${fact.title.charAt(0)}</div>`,
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            });

            const marker = L.marker([fact.lat, fact.lng], { icon: markerIcon })
                .addTo(map)
                .bindPopup(createPopupContent(fact))
                .on('click', () => selectFact(fact.id));

            markers.push(marker);
        });
    }

    // Crear contenido del popup, defino los colores
    function createPopupContent(fact) {
        const categoryColors = {
            politica: '#4f46e5',
            exploracion: '#059669',
            guerra: '#dc2626',
            independencia: '#f59e0b',
            cientifica: '#7c3aed'
        };

        return `
            <div class="popup-content">
                <h6>${fact.title}</h6>
                <span class="badge" style="background-color: ${categoryColors[fact.category]}; color: white;">
                    ${fact.category.charAt(0).toUpperCase() + fact.category.slice(1)}
                </span>
                <p class="small mt-2 mb-2">${fact.description}</p>
                <div class="small text-muted">
                    <div><i class="bi bi-geo-alt me-1"></i>${fact.location}</div>
                    <div><i class="bi bi-calendar me-1"></i>${fact.date}</div>
                </div>
            </div>
        `;
    }

    // Seleccionar un hecho
    function selectFact(factId) {
        selectedFactId = factId;
        const fact = historicalFacts.find(f => f.id === factId);

        // Actualizar vista de detalles
        document.getElementById('defaultView').classList.add('d-none');
        document.getElementById('factDetail').classList.remove('d-none');

        document.getElementById('factTitle').textContent = fact.title;
        document.getElementById('factDescription').textContent = fact.description;
        document.getElementById('factLocation').textContent = fact.location;
        document.getElementById('factDate').textContent = fact.date;
        document.getElementById('factMedia').textContent = fact.multimedia;

        // Actualizar badge de categoría
        const categoryBadge = document.getElementById('factCategory');
        const categoryColors = {
            politica: '#4f46e5',
            exploracion: '#059669',
            guerra: '#dc2626',
            independencia: '#f59e0b',
            cientifica: '#7c3aed'
        };

        categoryBadge.textContent = fact.category.charAt(0).toUpperCase() + fact.category.slice(1);
        categoryBadge.style.backgroundColor = categoryColors[fact.category];
        categoryBadge.style.color = 'white';

        // Actualizar lista visual
        updateFactsList();

        // Centrar el mapa en el marcador
        map.setView([fact.lat, fact.lng], 6);
    }

    // Limpiar selección
    function clearSelection() {
        selectedFactId = null;
        document.getElementById('defaultView').classList.remove('d-none');
        document.getElementById('factDetail').classList.add('d-none');
        updateFactsList();
        map.setView([-20, -60], 3);
    }

    // Generar lista de hechos
    function generateFactsList() {
        const factsList = document.getElementById('factsList');
        factsList.innerHTML = '';

        historicalFacts.forEach(fact => {
            const categoryColors = {
                politica: 'primary',
                exploracion: 'success',
                guerra: 'danger',
                independencia: 'warning',
                cientifica: 'secondary'
            };

            const factElement = document.createElement('div');
            factElement.className = `fact-list-item ${selectedFactId === fact.id ? 'selected' : ''}`;
            factElement.onclick = () => selectFact(fact.id);

            factElement.innerHTML = `
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="fw-semibold small">${fact.title}</div>
                        <div class="text-muted small">
                            <i class="bi bi-geo-alt me-1"></i>${fact.location}
                        </div>
                        <div class="text-muted small">
                            <i class="bi bi-calendar me-1"></i>${fact.date}
                        </div>
                    </div>
                    <span class="badge bg-${categoryColors[fact.category]} text-white">
                        ${fact.category.charAt(0).toUpperCase() + fact.category.slice(1)}
                    </span>
                </div>
            `;

            factsList.appendChild(factElement);
        });
    }

    // Actualizar lista de hechos
    function updateFactsList() {
        const factElements = document.querySelectorAll('.fact-list-item');
        factElements.forEach((element, index) => {
            if (historicalFacts[index].id === selectedFactId) {
                element.classList.add('selected');
            } else {
                element.classList.remove('selected');
            }
        });
    }

    // Filtrar por categoría
    function filterByCategory() {
        const categoryFilter = document.getElementById('categoryFilter').value;
        const filteredFacts = categoryFilter ?
            historicalFacts.filter(fact => fact.category === categoryFilter) :
            historicalFacts;

        addMarkersToMap(filteredFacts);
        updateEventCount(filteredFacts.length);
    }

    // Buscar hechos
    function searchFacts() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const categoryFilter = document.getElementById('categoryFilter').value;

        let filteredFacts = historicalFacts;

        if (categoryFilter) {
            filteredFacts = filteredFacts.filter(fact => fact.category === categoryFilter);
        }

        if (searchTerm) {
            filteredFacts = filteredFacts.filter(fact =>
                fact.title.toLowerCase().includes(searchTerm) ||
                fact.location.toLowerCase().includes(searchTerm) ||
                fact.description.toLowerCase().includes(searchTerm)
            );
        }

        addMarkersToMap(filteredFacts);
        updateEventCount(filteredFacts.length);
    }

    // Actualizar contador de eventos
    function updateEventCount(count) {
        document.getElementById('eventCount').textContent = `${count} eventos`;
        document.getElementById('statsEvents').textContent = count;
    }

    // Actualizar estadísticas
    function updateStats() {
        const countries = [...new Set(historicalFacts.map(fact =>
            fact.location.split(',').pop().trim()
        ))].length;
        document.getElementById('statsCountries').textContent = countries;
    }

    // Event listeners
    document.getElementById('categoryFilter').addEventListener('change', filterByCategory);
    document.getElementById('searchInput').addEventListener('input', searchFacts);

    // Inicializar mapa cuando se carga la página
    document.addEventListener('DOMContentLoaded', initMap);
</script>

</body>
</html>